<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>ì‹ ì§„í‰ì¥í„°ê³¼ì¼</title>
<style>
@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
* { box-sizing:border-box; margin:0; padding:0; -webkit-tap-highlight-color:transparent; }
:root {
  --green:#22C55E; --green-bg:#F0FDF4;
  --text:#111827; --sub:#6B7280; --muted:#9CA3AF;
  --bg:#F9FAFB; --surface:#fff;
  --border:#F3F4F6; --border-s:#E5E7EB;
  --danger:#EF4444;
}
html{font-size:16px}
body{font-family:'Pretendard',-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;max-width:430px;margin:0 auto;-webkit-font-smoothing:antialiased}

/* HEADER */
.hd{background:white;padding:0 20px;height:56px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;border-bottom:1px solid var(--border)}
.hd-logo{font-size:17px;font-weight:800;letter-spacing:-0.5px}
.hd-logo span{color:var(--green)}
.hd-actions{display:flex;gap:4px}
.btn-icon{width:36px;height:36px;border-radius:50%;background:var(--bg);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center}
.btn-txt{font-size:14px;font-weight:600;color:var(--sub);background:none;border:none;cursor:pointer;font-family:inherit;padding:8px 0 8px 8px}

/* DATE TABS */
.date-scroll{background:white;border-bottom:1px solid var(--border);overflow-x:auto;display:flex;padding:0 16px;scrollbar-width:none}
.date-scroll::-webkit-scrollbar{display:none}
.date-tab{flex-shrink:0;padding:14px 16px 12px;font-size:14px;font-weight:600;color:var(--muted);cursor:pointer;border:none;border-bottom:2px solid transparent;background:none;font-family:inherit;white-space:nowrap}
.date-tab.on{color:var(--text);border-bottom-color:var(--text)}
.date-tab .sub{font-size:11px;color:var(--green);font-weight:600;display:block;margin-top:1px}

/* EVENT INFO */
.ev-info{padding:20px 20px 0}
.ev-title{font-size:22px;font-weight:800;letter-spacing:-0.5px;line-height:1.3}
.ev-meta{font-size:14px;color:var(--sub);margin-top:6px}

/* CHIPS */
.chips{overflow-x:auto;display:flex;gap:8px;padding:16px 20px;scrollbar-width:none}
.chips::-webkit-scrollbar{display:none}
.chip{flex-shrink:0;padding:7px 14px;border-radius:100px;font-size:13px;font-weight:600;cursor:pointer;border:1.5px solid var(--border-s);background:white;color:var(--sub);font-family:inherit}
.chip.on{background:var(--text);border-color:var(--text);color:white}

/* CATEGORY HEADER */
.cat-hd{padding:20px 20px 10px;font-size:12px;font-weight:700;color:var(--muted);letter-spacing:0.5px}

/* PRODUCT ITEM */
.prod{background:white;padding:16px 20px;display:flex;align-items:center;border-bottom:1px solid var(--border)}
.prod:active{background:var(--bg)}
.prod.sold{opacity:0.4;pointer-events:none}
.pi{flex:1;min-width:0;padding-right:16px}
.pi-name{font-size:15px;font-weight:700;letter-spacing:-0.3px;margin-bottom:3px}
.pi-desc{font-size:13px;color:var(--sub);line-height:1.4;margin-bottom:6px}
.pi-price{font-size:16px;font-weight:800;letter-spacing:-0.3px}
.pi-price .slash{color:var(--muted);font-weight:400;font-size:13px;margin-left:2px}
.tag{display:inline-block;font-size:11px;font-weight:700;padding:2px 7px;border-radius:4px;margin-bottom:5px}
.tag-hot{background:#FEF3C7;color:#B45309}
.tag-out{background:var(--bg);color:var(--muted)}
.stock-low{font-size:12px;color:var(--danger);font-weight:600;margin-top:4px}
.qty-ctrl{display:flex;align-items:center;gap:12px;flex-shrink:0}
.qty-btn{width:30px;height:30px;border-radius:50%;border:none;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-family:inherit}
.qty-btn.minus{background:var(--bg);color:var(--sub)}
.qty-btn.minus:active{background:var(--border-s)}
.qty-btn.plus{background:var(--green);color:white}
.qty-btn.plus:active{background:#16A34A}
.qty-btn:disabled{opacity:0.25;cursor:default}
.qty-num{font-size:16px;font-weight:700;min-width:20px;text-align:center}
.divider{height:8px;background:var(--bg);border-top:1px solid var(--border);border-bottom:1px solid var(--border)}

/* CART BAR */
.cart-bar{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:430px;padding:12px 20px calc(12px + env(safe-area-inset-bottom));background:white;border-top:1px solid var(--border);z-index:100}
.btn-order{width:100%;padding:16px;border-radius:14px;border:none;background:var(--green);color:white;font-size:16px;font-weight:700;cursor:pointer;font-family:inherit;letter-spacing:-0.3px}
.btn-order:disabled{background:var(--border-s);color:var(--muted);cursor:default}
.btn-order:not(:disabled):active{background:#16A34A}

/* OVERLAY / SHEET */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);z-index:200;align-items:flex-end;justify-content:center}
.overlay.open{display:flex;animation:fi 0.2s}
@keyframes fi{from{opacity:0}to{opacity:1}}
.sheet{background:white;border-radius:24px 24px 0 0;width:100%;max-width:430px;max-height:90vh;overflow-y:auto;padding:0 0 calc(32px + env(safe-area-inset-bottom));animation:su 0.3s cubic-bezier(0.32,0.72,0,1);overscroll-behavior:contain}
@keyframes su{from{transform:translateY(100%)}to{transform:translateY(0)}}
.sh-handle{width:36px;height:4px;background:var(--border-s);border-radius:2px;margin:14px auto 0}
.sh-title{font-size:20px;font-weight:800;letter-spacing:-0.5px;padding:20px 20px 4px}
.sh-sub{font-size:14px;color:var(--sub);padding:0 20px 20px}

/* ORDER SUMMARY */
.ord-box{margin:0 20px 20px;background:var(--bg);border-radius:14px;padding:16px}
.ord-row{display:flex;justify-content:space-between;align-items:baseline;padding:4px 0;font-size:14px}
.ord-row .nm{color:var(--sub);font-weight:500;flex:1;margin-right:12px}
.ord-row .am{font-weight:700;white-space:nowrap}
.ord-row.total{border-top:1px solid var(--border-s);margin-top:8px;padding-top:12px;font-size:16px;font-weight:800}
.ord-row.total .am{color:var(--green)}

/* FIELDS */
.fg{padding:0 20px 14px}
.fg label{font-size:13px;font-weight:700;color:var(--sub);margin-bottom:8px;display:block}
.fg label .opt{font-weight:400;color:var(--muted)}
.inp{width:100%;padding:14px 16px;border:1.5px solid var(--border-s);border-radius:12px;font-size:15px;font-family:inherit;outline:none;color:var(--text);background:white;-webkit-appearance:none;transition:border-color 0.15s}
.inp:focus{border-color:var(--text)}
.inp.err{border-color:var(--danger)}
.ferr{font-size:12px;color:var(--danger);margin-top:6px;display:none}
.ferr.show{display:block}

/* PAYMENT */
.pay-opts{display:flex;gap:8px}
.pay-opt{flex:1;padding:12px 8px;border-radius:12px;border:1.5px solid var(--border-s);background:white;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;color:var(--sub);text-align:center}
.pay-opt.on{border-color:var(--text);background:var(--text);color:white}
.pay-opt .pi{font-size:18px;display:block;margin-bottom:4px}

/* PRIVACY */
.privacy{margin:0 20px 20px;padding:14px;background:var(--bg);border-radius:12px;font-size:12px;color:var(--sub);line-height:1.7}
.privacy strong{display:block;font-size:13px;font-weight:700;color:var(--text);margin-bottom:6px}

/* CTA */
.sh-cta{padding:0 20px}
.btn-submit{width:100%;padding:16px;border-radius:14px;border:none;background:var(--green);color:white;font-size:16px;font-weight:700;cursor:pointer;font-family:inherit}
.btn-submit:active{background:#16A34A}

/* SUCCESS */
.success-wrap{text-align:center;padding:48px 20px 32px}
.suc-icon{width:64px;height:64px;background:var(--green-bg);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 20px}
.suc-title{font-size:22px;font-weight:800;letter-spacing:-0.5px;margin-bottom:8px}
.suc-desc{font-size:15px;color:var(--sub);line-height:1.6}
.ord-num-box{margin:24px 20px 0;background:var(--bg);border-radius:14px;padding:18px 20px}
.ord-num-lbl{font-size:13px;color:var(--sub);margin-bottom:4px}
.ord-num-val{font-size:20px;font-weight:800;letter-spacing:-0.5px}
.kakao-notice{margin:12px 20px 0;background:#FEF9C3;border-radius:12px;padding:14px 16px;font-size:13px;color:#713F12;line-height:1.6;font-weight:500}
.btn-close{width:calc(100% - 40px);margin:20px 20px 0;padding:16px;border-radius:14px;border:1.5px solid var(--border-s);background:white;font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;color:var(--text)}

/* MY ORDERS */
.moc{margin:0 20px 10px;padding:16px;border:1.5px solid var(--border-s);border-radius:16px}
.moc-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}
.moc-name{font-size:15px;font-weight:700}
.moc-date{font-size:12px;color:var(--muted);margin-top:2px}
.badge{font-size:12px;font-weight:700;padding:4px 10px;border-radius:8px}
.b-pending{background:#EFF6FF;color:#1D4ED8}
.b-done{background:var(--green-bg);color:#15803D}
.moc-items{font-size:13px;color:var(--sub);line-height:1.7;margin-bottom:10px;border-top:1px solid var(--border);padding-top:10px}
.moc-total{font-size:15px;font-weight:800}
.no-result{text-align:center;padding:48px 20px;color:var(--muted);font-size:14px}

/* SEARCH */
.search-bar{display:flex;gap:8px;padding:16px 20px 8px}
.search-inp{flex:1;padding:12px 14px;border:1.5px solid var(--border-s);border-radius:12px;font-size:14px;font-family:inherit;outline:none;-webkit-appearance:none}
.search-inp:focus{border-color:var(--text)}
.search-btn{padding:12px 16px;background:var(--text);color:white;border:none;border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;font-family:inherit}

/* SHARE */
.share-item{display:flex;align-items:center;gap:16px;padding:16px 20px;cursor:pointer;border-bottom:1px solid var(--border)}
.share-item:active{background:var(--bg)}
.share-item:last-child{border-bottom:none}
.si-icon{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.si-copy{background:var(--bg);border:1.5px solid var(--border-s)}
.si-kko{background:#FEE500}
.si-qr{background:#EFF6FF}
.si-lbl{font-size:15px;font-weight:700}
.si-desc{font-size:13px;color:var(--sub);margin-top:2px}
.qr-wrap{padding:20px;text-align:center}
.qr-wrap p{font-size:13px;color:var(--sub);margin-top:12px;line-height:1.5}
.qr-url{font-size:12px;color:var(--muted);word-break:break-all;margin-top:8px;padding:10px;background:var(--bg);border-radius:8px}

/* MISC */
.empty{text-align:center;padding:64px 24px}
.empty .et{font-size:16px;font-weight:700;color:var(--sub);margin-bottom:8px}
.empty .es{font-size:14px;color:var(--muted)}
.pb{height:80px}
.toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%) translateY(8px);background:rgba(17,24,39,0.9);color:white;padding:12px 20px;border-radius:24px;font-size:14px;font-weight:600;z-index:999;opacity:0;transition:all 0.25s;pointer-events:none;white-space:nowrap}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
</style>
</head>
<body>

<header class="hd">
  <div class="hd-logo">ì‹ ì§„í‰<span>ì¥í„°</span>ê³¼ì¼</div>
  <div class="hd-actions">
    <button class="btn-icon" onclick="openSheet('sheetShare')">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/>
        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
      </svg>
    </button>
    <button class="btn-txt" onclick="openSheet('sheetMyOrders')">ì£¼ë¬¸ë‚´ì—­</button>
  </div>
</header>

<div class="date-scroll" id="dateTabs"></div>
<div class="ev-info"><div class="ev-title" id="evTitle"></div><div class="ev-meta" id="evMeta"></div></div>
<div class="chips" id="chips"></div>
<div id="prodList"></div>
<div class="pb"></div>

<div class="cart-bar">
  <button class="btn-order" id="btnOrder" disabled onclick="openSheet('sheetOrder')">ìƒí’ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”</button>
</div>

<!-- ì£¼ë¬¸ ì‹œíŠ¸ -->
<div class="overlay" id="sheetOrder" onclick="if(event.target===this)closeSheet('sheetOrder')">
  <div class="sheet">
    <div class="sh-handle"></div>
    <div class="sh-title">ì£¼ë¬¸ ì‹ ì²­</div>
    <div class="sh-sub">ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ ì¹´í†¡ìœ¼ë¡œ ê²°ì œ ë§í¬ë¥¼ ë³´ë‚´ë“œë ¤ìš”</div>
    <div class="ord-box" id="ordSummary"></div>
    <div class="fg">
      <label>ì´ë¦„</label>
      <input class="inp" id="iName" type="text" placeholder="ì´ë¦„ ë˜ëŠ” ë‹‰ë„¤ì„">
      <div class="ferr" id="eName">ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</div>
    </div>
    <div class="fg">
      <label>ì „í™”ë²ˆí˜¸</label>
      <input class="inp" id="iPhone" type="tel" placeholder="010-0000-0000">
      <div class="ferr" id="ePhone">ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</div>
    </div>
    <div class="fg">
      <label>ì£¼ì†Œ <span class="opt">ì•„íŒŒíŠ¸ëª…/ë™/í˜¸ìˆ˜</span></label>
      <input class="inp" id="iAddr" type="text" placeholder="ì˜ˆ) ë˜ë¯¸ì•ˆ 101ë™ 1001í˜¸">
    </div>
    <div class="fg">
      <label>ê²°ì œ ìˆ˜ë‹¨</label>
      <div class="pay-opts">
        <button class="pay-opt on" data-pay="card" onclick="selPay(this)"><span class="pi">ğŸ’³</span>ì¹´ë“œê²°ì œ</button>
        <button class="pay-opt" data-pay="transfer" onclick="selPay(this)"><span class="pi">ğŸ¦</span>ê³„ì¢Œì´ì²´</button>
        <button class="pay-opt" data-pay="pickup" onclick="selPay(this)"><span class="pi">ğŸ›</span>ë§¤ì¥í”½ì—…</button>
      </div>
    </div>
    <div class="fg">
      <label>ìš”ì²­ì‚¬í•­ <span class="opt">ì„ íƒ</span></label>
      <input class="inp" id="iNote" type="text" placeholder="ë°°ë‹¬ ê´€ë ¨ ìš”ì²­ì‚¬í•­">
    </div>
    <div class="privacy">
      <strong>ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜</strong>
      ìˆ˜ì§‘ ëª©ì : ê³µë™êµ¬ë§¤ ì£¼ë¬¸ ì ‘ìˆ˜ ë° ê²°ì œ ì•ˆë‚´<br>
      ìˆ˜ì§‘ í•­ëª©: ì´ë¦„, ì „í™”ë²ˆí˜¸, ì£¼ì†Œ / ë³´ìœ ê¸°ê°„: ìˆ˜ì§‘ì¼ë¡œë¶€í„° 1ë…„
    </div>
    <div class="sh-cta"><button class="btn-submit" onclick="submitOrder()">ì£¼ë¬¸ ì‹ ì²­í•˜ê¸°</button></div>
  </div>
</div>

<!-- ì™„ë£Œ ì‹œíŠ¸ -->
<div class="overlay" id="sheetOK">
  <div class="sheet">
    <div class="sh-handle"></div>
    <div class="success-wrap">
      <div class="suc-icon">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#22C55E" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
      </div>
      <div class="suc-title">ì£¼ë¬¸ì´ ì ‘ìˆ˜ëì–´ìš”</div>
      <div class="suc-desc">ì‹ ì§„í‰ì¥í„°ê³¼ì¼ì—ì„œ<br>ì‹ ì„ í•œ ìƒí’ˆì„ ì¤€ë¹„í•´ ë“œë¦´ê²Œìš”</div>
    </div>
    <div class="ord-num-box">
      <div class="ord-num-lbl">ì£¼ë¬¸ë²ˆí˜¸</div>
      <div class="ord-num-val" id="ordNumDisplay"></div>
    </div>
    <div class="kakao-notice">ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ê²°ì œ ë§í¬ë¥¼ ë³´ë‚´ë“œë ¤ìš”. ê²°ì œ ì™„ë£Œ í›„ ë°°ë‹¬ì´ ì§„í–‰ë©ë‹ˆë‹¤.</div>
    <button class="btn-close" onclick="closeSheet('sheetOK')">í™•ì¸</button>
  </div>
</div>

<!-- ì£¼ë¬¸ë‚´ì—­ ì‹œíŠ¸ -->
<div class="overlay" id="sheetMyOrders" onclick="if(event.target===this)closeSheet('sheetMyOrders')">
  <div class="sheet">
    <div class="sh-handle"></div>
    <div class="sh-title">ì£¼ë¬¸ë‚´ì—­</div>
    <div class="sh-sub">ì „í™”ë²ˆí˜¸ë¡œ ë‚´ ì£¼ë¬¸ì„ í™•ì¸í•´ìš”</div>
    <div class="search-bar">
      <input class="search-inp" id="searchPh" type="tel" placeholder="010-0000-0000" onkeydown="if(event.key==='Enter')searchOrds()">
      <button class="search-btn" onclick="searchOrds()">ì¡°íšŒ</button>
    </div>
    <div id="myOrdsResult"></div>
    <div style="height:24px"></div>
  </div>
</div>

<!-- ê³µìœ  ì‹œíŠ¸ -->
<div class="overlay" id="sheetShare" onclick="if(event.target===this)closeSheet('sheetShare')">
  <div class="sheet">
    <div class="sh-handle"></div>
    <div class="sh-title">ê³µìœ í•˜ê¸°</div>
    <div class="sh-sub">ê³ ê°ë“¤ì—ê²Œ ì£¼ë¬¸ í˜ì´ì§€ë¥¼ ê³µìœ í•´ìš”</div>
    <div class="share-item" onclick="copyLink()">
      <div class="si-icon si-copy">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#374151" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
        </svg>
      </div>
      <div><div class="si-lbl">ë§í¬ ë³µì‚¬</div><div class="si-desc">í˜„ì¬ í˜ì´ì§€ ì£¼ì†Œë¥¼ ë³µì‚¬í•´ìš”</div></div>
    </div>
    <div class="share-item" onclick="shareKakao()">
      <div class="si-icon si-kko">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="#3A1D1D">
          <path d="M12 3C6.48 3 2 6.58 2 11c0 2.8 1.64 5.26 4.12 6.82-.18.64-.66 2.34-.76 2.7-.12.44.16.43.34.31.14-.09 2.18-1.48 3.06-2.08.4.06.81.09 1.24.09 5.52 0 10-3.58 10-8S17.52 3 12 3z"/>
        </svg>
      </div>
      <div><div class="si-lbl">ì¹´ì¹´ì˜¤í†¡ ê³µìœ </div><div class="si-desc">ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ë§í¬ë¥¼ ê³µìœ í•´ìš”</div></div>
    </div>
    <div class="share-item" onclick="toggleQR()">
      <div class="si-icon si-qr">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#1D4ED8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
          <path d="M14 14h3v3h-3zM17 17h3v3h-3zM14 20h3"/>
        </svg>
      </div>
      <div><div class="si-lbl">QR ì½”ë“œ</div><div class="si-desc">QRì½”ë“œë¥¼ ìƒì„±í•´ì„œ ê³µìœ í•´ìš”</div></div>
    </div>
    <div id="qrContainer" style="display:none">
      <div class="qr-wrap">
        <div id="qrImg"></div>
        <p>ì´ QRì½”ë“œë¥¼ ìŠ¤ìº”í•˜ë©´ ì£¼ë¬¸ í˜ì´ì§€ë¡œ ì´ë™í•´ìš”</p>
        <div class="qr-url" id="qrUrl"></div>
      </div>
    </div>
    <div style="height:24px"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* â˜… ìŠ¤í† ë¦¬ì§€ í‚¤ admin.html ê³¼ ë™ì¼ */
const PK = 'sjpk4_products';
const OK = 'sjpk4_orders';

function today() { return new Date().toISOString().split('T')[0]; }
function fmtDate(d) {
  const dt = new Date(d+'T00:00:00'), w=['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
  return {label:`${dt.getMonth()+1}ì›” ${dt.getDate()}ì¼ (${w[dt.getDay()]})`, isToday:d===today()};
}

/* ê¸°ë³¸ ì¹´íƒˆë¡œê·¸ (adminê³¼ ë™ì¼) */
const CATALOG = [
  {cat:'ì±„ì†Œ',name:'êµ­ì‚° ì–‘ì†¡ì´ë²„ì„¯',desc:'200g',price:1900,unit:'1ë´‰',hot:true},
  {cat:'ì±„ì†Œ',name:'ê¸ˆì‚° ë´‰ì§€ ê¹»ì 30ì¥',desc:'1ë´‰ ì„¸íŠ¸',price:900,unit:'1ë´‰',hot:false},
  {cat:'ì±„ì†Œ',name:'ì•Œë°°ê¸° ìŒˆë°°ì¶”',desc:'500gê¸‰',price:1400,unit:'1ë´‰',hot:false},
  {cat:'ì±„ì†Œ',name:'ì‹±ì‹± êµ­ì‚° ë¸Œë¡œì½œë¦¬',desc:'250g ë‚´ì™¸',price:1900,unit:'1ê°œ',hot:false},
  {cat:'ì±„ì†Œ',name:'ë†í˜‘ ì‹±ì‹± ì‹œê¸ˆì¹˜',desc:'300g',price:1900,unit:'1ë´‰',hot:false},
  {cat:'ì±„ì†Œ',name:'êµ­ì‚° ë†í˜‘ ê°„ë§ˆëŠ˜',desc:'200g í†µí¬ì¥',price:2900,unit:'1ë´‰',hot:false},
  {cat:'ì±„ì†Œ',name:'êµ­ì‚° ì–‘ë°°ì¶” í° 1í†µ',desc:'',price:4000,unit:'1í†µ',hot:false},
  {cat:'êµ­ë‚´ì‚° ê³¼ì¼',name:'ë”¸ê¸° ì„¤í–¥ ì™•íŠ¹ ë‹¤ë¼ë”¸ê¸°',desc:'500g Â· 1ë²ˆ ë“±ê¸‰',price:7900,unit:'1íŒ©',hot:true},
  {cat:'êµ­ë‚´ì‚° ê³¼ì¼',name:'ì¼í’ˆ ì¥í¬ ë”¸ê¸°',desc:'500g Â· 3Ã—5ì‚¬ì´ì¦ˆ',price:4900,unit:'1íŒ©',hot:false},
  {cat:'êµ­ë‚´ì‚° ê³¼ì¼',name:'ì‚°ì²­ ì„¤í–¥ ë”¸ê¸°',desc:'500g',price:4900,unit:'1íŒ©',hot:false},
  {cat:'êµ­ë‚´ì‚° ê³¼ì¼',name:'ë§›ë„ë¦¬ ì œì£¼ ì²œí˜œí–¥',desc:'6ê°œ',price:10000,unit:'6ê°œ',hot:true},
  {cat:'êµ­ë‚´ì‚° ê³¼ì¼',name:'ì²œí˜œí–¥ ë°•ìŠ¤',desc:'3kg Â· 14ë¸Œë¦­ìŠ¤',price:19000,unit:'1ë°•ìŠ¤',hot:false},
  {cat:'êµ­ë‚´ì‚° ê³¼ì¼',name:'íŠ¹ìƒ ìƒì£¼ ê³¶ê°',desc:'700g ë‚´ì™¸',price:14000,unit:'1ë´‰',hot:false},
  {cat:'êµ­ë‚´ì‚° ê³¼ì¼',name:'ì°¸ë‹¤ë˜ ì œì£¼ ê·¸ë¦°í‚¤ìœ„',desc:'8ê°œ 1ë´‰',price:10000,unit:'1ë´‰',hot:false},
  {cat:'êµ­ë‚´ì‚° ê³¼ì¼',name:'ì•ˆë™ ë¶€ì‚¬ ì»¨í‹°ì‚¬ê³¼',desc:'5ê°œ 1ë´‰',price:8900,unit:'1ë´‰',hot:false},
  {cat:'êµ­ë‚´ì‚° ê³¼ì¼',name:'ë¹„ê°€ë¦¼ í•˜ìš°ìŠ¤ ê°ê·¤',desc:'1kg 1ë´‰',price:5900,unit:'1ë´‰',hot:false},
  {cat:'êµ­ë‚´ì‚° ê³¼ì¼',name:'ë¹„ê°€ë¦¼ í•˜ìš°ìŠ¤ ê°ê·¤ ë°•ìŠ¤',desc:'Mì‚¬ì´ì¦ˆ 5kg',price:27000,unit:'1ë°•ìŠ¤',hot:false},
  {cat:'êµ­ë‚´ì‚° ê³¼ì¼',name:'ìš´ë‘ë ¹ ì°°í† ë§ˆí† ',desc:'1kg 1ë´‰',price:5900,unit:'1ë´‰',hot:false},
  {cat:'êµ­ë‚´ì‚° ê³¼ì¼',name:'ì•Œí° ëŒ€ì¶” ë°©ìš¸í† ë§ˆí† ',desc:'750g',price:6000,unit:'1íŒ©',hot:false},
  {cat:'ìˆ˜ì… ê³¼ì¼',name:'ìŠ¤ìœ„íŠ¸ í° ë°”ë‚˜ë‚˜',desc:'1ì†¡ì´',price:3900,unit:'1ì†¡ì´',hot:false},
  {cat:'ìˆ˜ì… ê³¼ì¼',name:'ì•Œí° ì¹ ë ˆ ë¸”ë£¨ë² ë¦¬',desc:'125g 1íŒ©',price:3900,unit:'1íŒ©',hot:false},
  {cat:'ê²¬ê³¼Â·íŠ¹ì‚°',name:'ê¿€ë°¤ ìƒìœ¨ë°¤',desc:'400g',price:6900,unit:'1ë´‰',hot:false},
  {cat:'ê²¬ê³¼Â·íŠ¹ì‚°',name:'í–‡ í”¼í˜¸ë‘ ê»ì§ˆí˜¸ë‘',desc:'500g',price:4900,unit:'1ë´‰',hot:false},
  {cat:'ê²¬ê³¼Â·íŠ¹ì‚°',name:'ë³¶ìŒ ê»ì§ˆ í”¼ë•…ì½©',desc:'500g',price:3900,unit:'1ë´‰',hot:false},
  {cat:'ì»µê³¼ì¼Â·ë‹¬ê±€',name:'ì»µê³¼ì¼ 8ì˜¨ì¦ˆ',desc:'ì œì² ê³¼ì¼ 6-7ê°€ì§€',price:4500,unit:'1ì»µ',hot:false},
  {cat:'ì»µê³¼ì¼Â·ë‹¬ê±€',name:'ìœ ì •ë€ ë‹¬ê±€',desc:'ë‚œê°1ë²ˆ ì¤‘ë€ 30êµ¬',price:13000,unit:'1íŒ',hot:false},
  {cat:'ìˆ˜ì‚°ë¬¼',name:'ì•ˆë™ ê°„ê³ ë“±ì–´',desc:'2ë¯¸',price:5000,unit:'2ë¯¸',hot:false},
  {cat:'ìˆ˜ì‚°ë¬¼',name:'ì•ˆë™ ìˆœì‚´ê°„ê³ ë“±ì–´í•„ë ›',desc:'5ì¡°ê°',price:8000,unit:'1ì¤„',hot:false},
  {cat:'ìˆ˜ì‚°ë¬¼',name:'ë² íŠ¸ë‚¨ ì¹µí…Œì¼ìƒˆìš°',desc:'900g',price:19000,unit:'1íŒ©',hot:true},
];
function uid(){return String(Date.now())+String(Math.floor(Math.random()*9999)).padStart(4,'0');}

function getProds(){
  const s=localStorage.getItem(PK);
  if(!s){
    const init=CATALOG.map(p=>({...p,id:uid(),stock:99,soldOut:false,date:today()}));
    localStorage.setItem(PK,JSON.stringify(init));
    return init;
  }
  return JSON.parse(s).map(p=>({...p,id:String(p.id)}));
}
function getOrds(){const s=localStorage.getItem(OK);return s?JSON.parse(s):[];}
function setOrds(arr){localStorage.setItem(OK,JSON.stringify(arr));}

/* ìƒíƒœ */
let cart={}, selDate=today(), selCat='ì „ì²´', curPay='card';

/* ë‚ ì§œ ëª©ë¡ */
function getDates(){return[...new Set(getProds().map(p=>p.date))].sort();}

/* ë Œë”ë§ */
function renderAll(){
  renderDateTabs();renderEvBanner();renderChips();renderProds();renderCartBtn();
}

function renderDateTabs(){
  const dates=getDates();
  if(!dates.includes(selDate)&&dates.length) selDate=dates[dates.length-1];
  document.getElementById('dateTabs').innerHTML=dates.map(d=>{
    const {label,isToday}=fmtDate(d);
    const cnt=getProds().filter(p=>p.date===d&&!p.soldOut).length;
    return `<button class="date-tab ${d===selDate?'on':''}" onclick="pickDate('${d}')">
      ${label}<span class="sub">${isToday?'ì˜¤ëŠ˜':cnt+'ì¢…'}</span></button>`;
  }).join('');
}
function renderEvBanner(){
  const {label,isToday}=fmtDate(selDate);
  document.getElementById('evTitle').textContent=`${label} ê³µë™êµ¬ë§¤`;
  document.getElementById('evMeta').textContent=isToday?'ì˜¤ëŠ˜ ì£¼ë¬¸ ë§ˆê° Â· ê²°ì œ ì•ˆë‚´ëŠ” ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ë“œë ¤ìš”':'ì‚¬ì „ ì˜ˆì•½ ì£¼ë¬¸';
}
function renderChips(){
  const cats=['ì „ì²´',...[...new Set(getProds().filter(p=>p.date===selDate).map(p=>p.cat))]];
  document.getElementById('chips').innerHTML=cats.map(c=>
    `<button class="chip ${c===selCat?'on':''}" onclick="pickCat('${c}')">${c}</button>`
  ).join('');
}
function renderProds(){
  let ps=getProds().filter(p=>p.date===selDate);
  if(selCat!=='ì „ì²´') ps=ps.filter(p=>p.cat===selCat);
  const el=document.getElementById('prodList');
  if(!ps.length){el.innerHTML=`<div class="empty"><div class="et">ìƒí’ˆì´ ì—†ì–´ìš”</div><div class="es">ë‹¤ë¥¸ ë‚ ì§œë¥¼ ì„ íƒí•´ë³´ì„¸ìš”</div></div>`;return;}
  const grp={};
  ps.forEach(p=>{if(!grp[p.cat])grp[p.cat]=[];grp[p.cat].push(p);});
  let html='';
  Object.entries(grp).forEach(([cat,items])=>{
    html+=`<div class="divider"></div><div class="cat-hd">${cat}</div>`;
    items.forEach(p=>{
      const qty=cart[p.id]||0;
      html+=`<div class="prod${p.soldOut?' sold':''}">
        <div class="pi">
          ${p.soldOut?'<span class="tag tag-out">í’ˆì ˆ</span>':p.hot?'<span class="tag tag-hot">ì¸ê¸°</span>':''}
          <div class="pi-name">${p.name}</div>
          ${p.desc?`<div class="pi-desc">${p.desc}</div>`:''}
          <div class="pi-price">${p.price.toLocaleString()}ì›<span class="slash">/ ${p.unit}</span></div>
          ${p.stock>0&&p.stock<=5?`<div class="stock-low">[${p.stock}ê°œ ë‚¨ìŒ] ì„ë°•!</div>`:''}
        </div>
        <div class="qty-ctrl">
          <button class="qty-btn minus" onclick="chgQty('${p.id}',-1)" ${qty===0?'disabled':''}>âˆ’</button>
          <span class="qty-num">${qty}</span>
          <button class="qty-btn plus" onclick="chgQty('${p.id}',1)">+</button>
        </div>
      </div>`;
    });
  });
  el.innerHTML=html;
}
function renderCartBtn(){
  const total=Object.values(cart).reduce((a,b)=>a+b,0);
  const btn=document.getElementById('btnOrder');
  if(!total){btn.textContent='ìƒí’ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”';btn.disabled=true;return;}
  const ps=getProds();
  const price=Object.entries(cart).reduce((a,[id,q])=>{
    const p=ps.find(x=>x.id===id);return a+(p?p.price*q:0);
  },0);
  btn.textContent=`${total}ê°œ ë‹´ê¸° Â· ${price.toLocaleString()}ì›`;
  btn.disabled=false;
}

/* ì¸í„°ë™ì…˜ */
function pickDate(d){selDate=d;selCat='ì „ì²´';cart={};renderAll();}
function pickCat(c){selCat=c;renderChips();renderProds();}
function chgQty(id,delta){
  const p=getProds().find(x=>x.id===id);
  if(!p)return;
  const n=Math.max(0,(cart[id]||0)+delta);
  if(n===0)delete cart[id];else cart[id]=n;
  renderProds();renderCartBtn();
}
function selPay(el){
  document.querySelectorAll('.pay-opt').forEach(b=>b.classList.remove('on'));
  el.classList.add('on');curPay=el.dataset.pay;
}

/* ì£¼ë¬¸ ì‹œíŠ¸ */
function openSheet(id){
  if(id==='sheetOrder') buildSummary();
  if(id==='sheetMyOrders'){
    document.getElementById('myOrdsResult').innerHTML='';
    document.getElementById('searchPh').value='';
    const me=JSON.parse(localStorage.getItem('sjpk4_me')||'{}');
    if(me.phone)document.getElementById('searchPh').value=me.phone;
  }
  if(id==='sheetShare') document.getElementById('qrContainer').style.display='none';
  document.getElementById(id).classList.add('open');
}
function closeSheet(id){document.getElementById(id).classList.remove('open');}

function buildSummary(){
  const ps=getProds(); let html='',total=0;
  Object.entries(cart).forEach(([id,qty])=>{
    const p=ps.find(x=>x.id===id);if(!p)return;
    const sub=p.price*qty;total+=sub;
    html+=`<div class="ord-row"><span class="nm">${p.name} Ã— ${qty} ${p.unit}</span><span class="am">${sub.toLocaleString()}ì›</span></div>`;
  });
  html+=`<div class="ord-row total"><span>í•©ê³„</span><span class="am">${total.toLocaleString()}ì›</span></div>`;
  document.getElementById('ordSummary').innerHTML=html;
  const me=JSON.parse(localStorage.getItem('sjpk4_me')||'{}');
  document.getElementById('iName').value=me.name||'';
  document.getElementById('iPhone').value=me.phone||'';
  document.getElementById('iAddr').value=me.addr||'';
  document.getElementById('iNote').value='';
  curPay='card';
  document.querySelectorAll('.pay-opt').forEach(b=>b.classList.remove('on'));
  document.querySelector('[data-pay="card"]').classList.add('on');
}

function submitOrder(){
  const name=document.getElementById('iName').value.trim();
  const phone=document.getElementById('iPhone').value.trim();
  let ok=true;
  ['iName','iPhone'].forEach(id=>document.getElementById(id).classList.remove('err'));
  ['eName','ePhone'].forEach(id=>document.getElementById(id).classList.remove('show'));
  if(!name){document.getElementById('iName').classList.add('err');document.getElementById('eName').classList.add('show');ok=false;}
  if(!phone){document.getElementById('iPhone').classList.add('err');document.getElementById('ePhone').classList.add('show');ok=false;}
  if(!ok)return;
  localStorage.setItem('sjpk4_me',JSON.stringify({name,phone,addr:document.getElementById('iAddr').value}));
  const ps=getProds(), items=[], labels={card:'ì¹´ë“œê²°ì œ',transfer:'ê³„ì¢Œì´ì²´',pickup:'ë§¤ì¥í”½ì—…'};
  let total=0;
  Object.entries(cart).forEach(([id,qty])=>{
    const p=ps.find(x=>x.id===id);
    if(p){items.push({id:p.id,name:p.name,qty:Number(qty),unit:p.unit,price:p.price,sub:p.price*Number(qty)});total+=p.price*Number(qty);}
  });
  const num='SJP-'+Date.now().toString().slice(-7);
  const ord={
    id:num,name,phone,
    addr:document.getElementById('iAddr').value,
    note:document.getElementById('iNote').value,
    payMethod:labels[curPay]||curPay,
    items,total,date:selDate,
    createdAt:new Date().toISOString(),status:'pending'
  };
  const ords=getOrds();ords.push(ord);setOrds(ords);
  cart={};closeSheet('sheetOrder');
  document.getElementById('ordNumDisplay').textContent=num;
  openSheet('sheetOK');renderAll();
}

/* ì£¼ë¬¸ ë‚´ì—­ */
function searchOrds(){
  const ph=document.getElementById('searchPh').value.trim().replace(/-/g,'');
  if(!ph){showToast('ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');return;}
  const ords=getOrds().filter(o=>o.phone.replace(/-/g,'')===ph).reverse();
  const el=document.getElementById('myOrdsResult');
  if(!ords.length){el.innerHTML=`<div class="no-result">ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ì–´ìš”</div>`;return;}
  el.innerHTML=ords.map(o=>{
    const d=new Date(o.createdAt);
    const ts=`${d.getMonth()+1}/${d.getDate()} ${d.getHours()}:${String(d.getMinutes()).padStart(2,'0')}`;
    const items=(o.items||[]).map(i=>`${i.name} Ã— ${Number(i.qty)} ${i.unit}`).join(', ');
    const badge=o.status==='done'?'<span class="badge b-done">ì™„ë£Œ</span>':'<span class="badge b-pending">ì ‘ìˆ˜</span>';
    return `<div class="moc">
      <div class="moc-top"><div><div class="moc-name">${o.name}</div><div class="moc-date">${ts} Â· ${o.id}</div></div>${badge}</div>
      <div class="moc-items">${items}${o.payMethod?`<br>ê²°ì œ: ${o.payMethod}`:''}</div>
      <div class="moc-total">${o.total.toLocaleString()}ì›</div>
    </div>`;
  }).join('');
}

/* ê³µìœ  */
function copyLink(){
  const url=location.href;
  if(navigator.clipboard){navigator.clipboard.writeText(url).then(()=>showToast('ë§í¬ê°€ ë³µì‚¬ëì–´ìš”'));}
  else{const ta=document.createElement('textarea');ta.value=url;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);showToast('ë§í¬ê°€ ë³µì‚¬ëì–´ìš”');}
}
function shareKakao(){
  const url=location.href;
  if(window.Kakao&&window.Kakao.isInitialized()){
    window.Kakao.Share.sendDefault({objectType:'feed',content:{title:'ì‹ ì§„í‰ì¥í„°ê³¼ì¼ ê³µë™êµ¬ë§¤',description:'ì‹ ì„ í•œ ê³¼ì¼Â·ì±„ì†Œë¥¼ ì§€ê¸ˆ ì£¼ë¬¸í•˜ì„¸ìš”!',imageUrl:'',link:{mobileWebUrl:url,webUrl:url}},buttons:[{title:'ì£¼ë¬¸í•˜ëŸ¬ ê°€ê¸°',link:{mobileWebUrl:url,webUrl:url}}]});
  } else {copyLink();showToast('ë§í¬ë¥¼ ë³µì‚¬í–ˆì–´ìš”. ì¹´ì¹´ì˜¤í†¡ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”!');}
}
function toggleQR(){
  const c=document.getElementById('qrContainer');
  if(c.style.display==='none'){c.style.display='block';genQR();}else c.style.display='none';
}
function genQR(){
  const url=location.href;
  document.getElementById('qrUrl').textContent=url;
  document.getElementById('qrImg').innerHTML=`<img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(url)}&format=png&margin=10" style="width:200px;height:200px;border-radius:12px" alt="QR">`;
}

function showToast(msg){
  const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2500);
}

renderAll();
</script>
</body>
</html>
